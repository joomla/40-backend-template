Joomla=window.Joomla||{},Joomla.MediaManager=Joomla.MediaManager||{},function(){"use strict";var a=Joomla.getOptions("com_media",{});if(a){Joomla.MediaManager.Edit.original={filename:a.uploadPath.split("/").pop(),extension:a.uploadPath.split(".").pop(),contents:"data:image/"+a.uploadPath.split(".").pop()+";base64,"+a.contents},Joomla.MediaManager.Edit.history={},Joomla.MediaManager.Edit.current={},Joomla.MediaManager.Edit.Reset=function(a){(!a||a&&"initial"===a)&&(Joomla.MediaManager.Edit.current.contents=Joomla.MediaManager.Edit.original.contents),document.getElementById("media-manager-edit-container").innerHTML="";var t=document.getElementById("myTab").firstElementChild;if("UL"===t.tagName)for(var o=[].slice.call(t.querySelectorAll("a")),i=0,n=o.length;i<n;i++)if(o[i].classList.contains("active")){Joomla.MediaManager.Edit[o[i].id.replace("tab-attrib-","").toLowerCase()].Deactivate();var r=Joomla.MediaManager.Edit.current;(!a||a&&!0!==a)&&(r=Joomla.MediaManager.Edit.original),o[i].click(),e(o[i].id.replace("tab-attrib-",""),r);break}},window.addEventListener("mediaManager.history.point",function(){if(Joomla.MediaManager.Edit.original!==Joomla.MediaManager.Edit.current.contents){var a=Object.keys(Joomla.MediaManager.Edit.history).length;if(Joomla.MediaManager.Edit.history[a]&&Joomla.MediaManager.Edit.history[a-1]&&Joomla.MediaManager.Edit.history[a]===Joomla.MediaManager.Edit.history[a-1])return;Joomla.MediaManager.Edit.history[a+1]=Joomla.MediaManager.Edit.current.contents}}),Joomla.MediaManager.Edit.Undo=function(){},Joomla.MediaManager.Edit.Redo=function(){},Joomla.MediaManager.Edit.createProgressBar=function(){},Joomla.MediaManager.Edit.updateProgressBar=function(a){},Joomla.MediaManager.Edit.removeProgressBar=function(){},Joomla.submitbutton=function(e){var t="jpg"===Joomla.MediaManager.Edit.original.extension?"jpeg":Joomla.MediaManager.Edit.original.extension,o=window.location.pathname.replace(/&view=file.*/g,""),i=a.uploadPath.split("/").pop(),n={name:i,content:Joomla.MediaManager.Edit.current.contents.replace("data:image/"+t+";base64,","")},r=a.uploadPath,d=a.apiBaseUrl+"&task=api.files&path="+r,l="application/json";n[a.csrfToken]="1";var s=r.split("/");switch(s.pop(),(s=s.join("/")).endsWith(":")&&(s+="/"),e){case"apply":Joomla.UploadFile.exec(i,JSON.stringify(n),r,d,l),Joomla.MediaManager.Edit.Reset(!0);break;case"save":Joomla.UploadFile.exec(i,JSON.stringify(n),r,d,l),window.location=o+"?option=com_media&path="+s;break;case"cancel":window.location=o+"?option=com_media&path="+s;break;case"reset":Joomla.MediaManager.Edit.Reset("initial")}},Joomla.UploadFile={},Joomla.UploadFile.exec=function(a,e,t,o,i){var n=new XMLHttpRequest;n.upload.onprogress=function(a){Joomla.MediaManager.Edit.updateProgressBar(a.loaded/a.total*100)},n.onload=function(){try{var a=JSON.parse(n.responseText)}catch(e){a=null}a?200==n.status&&(1==a.success&&Joomla.MediaManager.Edit.removeProgressBar(),"1"==a.status&&(Joomla.renderMessages({success:[a.message]},"true"),Joomla.MediaManager.Edit.removeProgressBar())):Joomla.MediaManager.Edit.removeProgressBar()},n.onerror=function(){Joomla.MediaManager.Edit.removeProgressBar()},n.open("PUT",o,!0),n.setRequestHeader("Content-Type",i),Joomla.MediaManager.Edit.createProgressBar(),n.send(e)},document.addEventListener("DOMContentLoaded",function(){var a=function(){var t=document.getElementById("myTab").firstElementChild;if("UL"===t.tagName){var o=[].slice.call(t.querySelectorAll("a"));o[0]&&e(o[0].id.replace("tab-attrib-",""),Joomla.MediaManager.Edit.original);for(var i=0,n=o.length;i<n;i++)o[i].addEventListener("joomla.tab.shown",function(a){a.relatedTarget&&(Joomla.MediaManager.Edit[a.relatedTarget.id.replace("tab-attrib-","").toLowerCase()].Deactivate(),document.getElementById("media-manager-edit-container").innerHTML="");var t=Joomla.MediaManager.Edit.current;!0 in Joomla.MediaManager.Edit.current&&(t=Joomla.MediaManager.Edit.original),e(a.target.id.replace("tab-attrib-",""),t)}),o[i].click();o[0]&&(o[0].click(),e(o[0].id.replace("tab-attrib-",""),Joomla.MediaManager.Edit.original))}else setTimeout(a,50)};setTimeout(a,50)});var e=function(a,e){if(e.contents){var t=document.getElementById("media-manager-edit-container"),o=document.createElement("div"),i=document.createElement("div"),n=document.createElement("img"),r=document.createElement("img");t.innerHTML="",n.src=e.contents,n.id="image-source",n.style.maxWidth="100%",r.src=e.contents,r.id="image-preview",r.style.maxWidth="100%",o.style.display="none",o.appendChild(n),t.appendChild(o),i.appendChild(r),t.appendChild(i),Joomla.MediaManager.Edit[a.toLowerCase()].Activate(e)}}}}();