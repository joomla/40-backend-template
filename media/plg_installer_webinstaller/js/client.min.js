var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}if(!window.jQuery)throw new Error("WebInstaller plugin requires jQuery");if(!Joomla)throw new Error("Joomla API is not properly initialised");!function(e,t,i,n){"use strict";var l={view:"dashboard",id:0,ordering:"",list:0,options:i.getOptions("plg_installer_webinstaller",{})},a=void 0,r=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"initialise",value:function(){if(l.loaded=1,t.getElementById("myTabContent")){var e=t.getElementById("web");t.getElementById("uploadform-web-cancel").addEventListener("click",function(){t.getElementById("uploadform-web").classList.add("hidden"),l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click()}),e.insertAdjacentHTML("afterbegin",'<div id="appsloading" class="ifw-loading-container"></div>'),e.style.position="absolute",n("#appsloading").on("ajaxStart",function(){t.body.classList.add("ifw-busy"),t.getElementById("appsloading").classList.remove("hidden")}).on("ajaxStop",function(){t.getElementById("appsloading").classList.add("hidden"),t.body.classList.remove("ifw-busy")})}this.loadweb(l.options.base_url+"index.php?format=json&option=com_apps&view=dashboard"),this.clickforlinks()}},{key:"loadweb",value:function(r){if(!r)return!1;var o=this,s=new RegExp(l.options.base_url),d=new RegExp("^index.php");if(!s.test(r)&&!d.test(r))return e.open(r,"_blank"),!1;var c=r+"&product="+l.options.product+"&release="+l.options.release+"&dev_level="+l.options.dev_level+"&list="+(l.list?"list":"grid")+"&lang="+l.options.language;if(""!==l.ordering&&t.getElementById("com-apps-ordering").value&&(l.ordering=t.getElementById("com-apps-ordering").value,c+="&ordering="+l.ordering),t.getElementById("myTabContent")){var u=t.getElementById("appsloading");u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%";var p=t.getElementById("web");p.style.position="relative",p.appendChild(u),n("#appsloading").trigger("ajaxStart")}return n.ajax({url:c,dataType:"jsonp",cache:!0,jsonpCallback:"jedapps_jsonpcallback",timeout:2e4,success:function(e){t.getElementById("web-loader")&&t.getElementById("web-loader").classList.add("hidden"),t.getElementById("jed-container").innerHTML=e.data.html,t.getElementById("com-apps-searchbox").addEventListener("keypress",function(e){13===e.which&&o.initiateSearch()}),t.getElementById("search-extensions").addEventListener("click",function(){o.initiateSearch()}),t.getElementById("search-reset").addEventListener("click",function(){t.getElementById("com-apps-searchbox").value="",o.initiateSearch()});var i=t.getElementById("com-apps-ordering");i&&i.addEventListener("change",function(){var e=i.selectedIndex;l.ordering=i.options[e].value,o.installfromwebajaxsubmit()}),""!==l.options.installfrom_url&&o.installfromweb(l.options.installfrom_url)},fail:function(){t.getElementById("web-loader")&&(t.getElementById("web-loader").classList.add("hidden"),t.getElementById("web-loader-error").classList.remove("hidden"))},complete:function(){var r=t.getElementById("joomlaapsinstallatinput");if(r&&(r.value=l.options.installat_url),o.clickforlinks(),a.clicker(),"extension"!==l.view&&[].slice.call(t.querySelectorAll("div.load-extension")).forEach(function(e){e.addEventListener("click",function(t){t.preventDefault(),o.processLinkClick(e.getAttribute("data-url"))}),e.setAttribute("href","#")}),"extension"===l.view){var s=t.getElementById("install-extension"),d=t.getElementById("install-extension-from-external");s&&s.addEventListener("click",function(){o.installfromweb(s.getAttribute("data-downloadurl"),s.getAttribute("data-name"))}),d&&d.addEventListener("click",function(){var n=d.getAttribute("data-downloadurl");!0===e.confirm(i.JText._("PLG_INSTALLER_WEBINSTALLER_REDIRECT_TO_EXTERNAL_SITE_TO_INSTALL").replace("[SITEURL]",n))&&(t.getElementById("adminForm").setAttribute("action",n),t.querySelector("input[name=task]").setAttribute("disabled",!0),t.querySelector("input[name=install_directory]").setAttribute("disabled",!0),t.querySelector("input[name=install_url]").setAttribute("disabled",!0),t.querySelector("input[name=installtype]").setAttribute("disabled",!0),t.querySelector("input[name=filter_search]").setAttribute("disabled",!0),t.getElementById("adminForm").submit())})}l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click(),t.getElementById("myTabContent")&&n("#appsloading").trigger("ajaxStop")},error:function(e){var i=t.getElementById("web-loader-error"),n=t.getElementById("web-loader");e.responseText&&i&&(i.innerHTML=e.responseText),n&&(n.classList.add("hidden"),i.classList.remove("hidden"))}}),!0}},{key:"clickforlinks",value:function(){var e=this;[].slice.call(t.querySelectorAll("a.transcode")).forEach(function(t){var i=t.getAttribute("href");t.addEventListener("click",function(t){t.preventDefault(),e.processLinkClick(i)}),t.setAttribute("href","#")})}},{key:"initiateSearch",value:function(){l.view="dashboard",this.installfromwebajaxsubmit()}},{key:"installfromwebajaxsubmit",value:function(){var e="&view="+l.view;(l.id&&(e+="&id="+l.id),t.getElementById("com-apps-searchbox").value)&&(e+="&filter_search="+encodeURI(t.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim()));""!==l.ordering&&t.getElementById("com-apps-ordering").value&&(l.ordering=t.getElementById("com-apps-ordering").value),l.ordering&&(e+="&ordering="+l.ordering),this.loadweb(l.options.base_url+"index.php?format=json&option=com_apps"+e)}},{key:"processLinkClick",value:function(e){var t=new RegExp(l.options.base_url),i=new RegExp("^index.php");t.test(e)||i.test(e)?(l.view=e.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===l.view?l.id=0:"category"===l.view&&(l.id=e.replace(/^.+[&?]id=(\d+).*$/,"$1")),this.loadweb(l.options.base_url+e)):this.loadweb(e)}},{key:"installfromweb",value:function(e,n){if(!e)return alert(i.JText._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")),!1;var l=t.getElementById("install_url"),a=t.getElementById("uploadform-web-url");(l.value=e,a.innerHTML=e,n)?(t.getElementById("uploadform-web-name").innerHTML=n,t.getElementById("uploadform-web-name-label").classList.remove("hidden")):t.getElementById("uploadform-web-name-label").classList.add("hidden");return t.getElementById("uploadform-web").classList.remove("hidden"),!0}}],[{key:"clicker",value:function(){t.querySelector(".grid-view")&&t.querySelector(".grid-view").addEventListener("click",function(){l.list=0,t.querySelector(".list-container").classList.add("hidden"),t.querySelector(".grid-container").classList.remove("hidden"),t.getElementById("btn-list-view").classList.remove("active"),t.getElementById("btn-grid-view").classList.remove("active")}),t.querySelector(".list-view")&&t.querySelector(".list-view").addEventListener("click",function(){l.list=1,t.querySelector(".grid-container").classList.add("hidden"),t.querySelector(".list-container").classList.remove("hidden"),t.getElementById("btn-grid-view").classList.remove("active"),t.getElementById("btn-list-view").classList.add("active")})}}]),a}();n(function(e){var t=e("#myTabTabs").find('a[href="#web"]');l.options.installfromon&&t.click(),t.hasClass("active")&&(a||(a=new r).initialise()),t.closest("li").click(function(){a||(a=new r).initialise()}),""!==l.options.installfrom_url&&t.closest("li").click(),t.on("shown.bs.tab",function(){a||(a=new r).initialise()})})}(window,document,Joomla,window.jQuery);